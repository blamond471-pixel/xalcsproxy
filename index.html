<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="description" content="Xalcs Proxy v0 - Fatih/MEB filtrelerini aşmak için hızlı ve basit web proxy."/>
  <meta name="theme-color" content="#0f0f1a"/>
  <meta name="robots" content="noindex, nofollow"/>
  <title>Xalcs Proxy v0</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* Mevcut stil bloğun tamamen aynı kalabilir – buraya tekrar yazmıyorum, sadece script kısmı değişiyor */
    :root {
      --bg: #0a0e17;
      --darker: #05070d;
      --primary: #00ffea;
      --accent: #ff00d4;
      --text: #e0ffff;
      --gray: #7aa0c0;
      --error: #ff3366;
      --success: #00ff88;
    }
    /* ... kalan tüm stil aynı ... */
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="title">XALCS PROXY</div>
      <div class="subtitle">v0 • Fatih Bypass • Vercel Powered</div>
    </div>
  </header>

  <main>
    <div class="input-group">
      <input type="text" id="urlInput" placeholder="youtube yaz veya https://google.com gir..." autofocus autocomplete="off" spellcheck="false"/>
      <button id="goBtn">BAĞLAN</button>
    </div>

    <div id="status">Site adresini gir → Enter veya butona bas → Özgür internet</div>

    <div id="frameContainer">
      <div id="loading">
        <div class="loader"></div>
        <div>Xalcs Bağlanıyor...</div>
      </div>
      <iframe id="proxyFrame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation allow-storage-access-by-user-activation allow-modals allow-downloads"></iframe>
    </div>
  </main>

  <footer>
    Xalcs Proxy v0 • Moon Evreni Edition • 2026<br>
    Sunucu tarafı proxy aktif • Çoğu site şimdi açılır
  </footer>

  <script>
    const urlInput = document.getElementById('urlInput');
    const goBtn = document.getElementById('goBtn');
    const proxyFrame = document.getElementById('proxyFrame');
    const loading = document.getElementById('loading');
    const status = document.getElementById('status');

    const shortcuts = {
      youtube: 'https://www.youtube.com',
      yt: 'https://www.youtube.com',
      google: 'https://www.google.com',
      twitch: 'https://www.twitch.tv',
      netflix: 'https://www.netflix.com',
      discord: 'https://discord.com/app',
      instagram: 'https://www.instagram.com',
      x: 'https://x.com',
      twitter: 'https://twitter.com',
      roblox: 'https://www.roblox.com',
      github: 'https://github.com',
      tiktok: 'https://www.tiktok.com',
      spotify: 'https://open.spotify.com',
      chatgpt: 'https://chat.openai.com'
    };

    function normalizeUrl(input) {
      input = input.trim();
      if (!input) return null;

      if (shortcuts[input.toLowerCase()]) {
        return shortcuts[input.toLowerCase()];
      }

      if (!input.startsWith('http')) {
        if (input.includes('.')) {
          return 'https://' + input;
        }
        return 'https://www.google.com/search?q=' + encodeURIComponent(input);
      }
      return input;
    }

    function loadSite() {
      const rawInput = urlInput.value.trim();
      const targetUrl = normalizeUrl(rawInput);

      if (!targetUrl) {
        status.textContent = 'Geçerli bir adres gir!';
        status.style.color = 'var(--error)';
        return;
      }

      // ÖNEMLİ: Sunucu tarafı proxy kullanıyoruz → /proxy/ + base64
      const encodedTarget = btoa(targetUrl);  // base64 encode
      const proxyUrl = `/proxy/${encodedTarget}`;

      status.textContent = `Bağlanıyor: ${targetUrl.replace('https://', '')} (Proxy üzerinden)`;
      status.style.color = 'var(--primary)';
      loading.style.opacity = '1';

      proxyFrame.src = proxyUrl;   // ← Burası değişti! Artık direkt targetUrl değil

      const timeout = setTimeout(() => {
        if (loading.style.opacity === '1') {
          status.textContent = 'Yükleme uzun sürüyor... Site çok yavaş veya engelli olabilir.';
          status.style.color = 'var(--error)';
          loading.style.opacity = '0';
        }
      }, 20000);

      proxyFrame.onload = () => {
        clearTimeout(timeout);
        try {
          const loc = proxyFrame.contentWindow.location;
          status.textContent = `Açıldı → ${loc.hostname} (Proxy aktif)`;
          status.style.color = 'var(--success)';
        } catch (e) {
          status.textContent = 'Site yüklendi (cross-origin korumalı olabilir)';
          status.style.color = 'var(--success)';
        }
        loading.style.opacity = '0';
      };

      proxyFrame.onerror = () => {
        clearTimeout(timeout);
        status.textContent = 'Proxy bağlantı hatası. Vercel loglarını kontrol et.';
        status.style.color = 'var(--error)';
        loading.style.opacity = '0';
      };
    }

    goBtn.addEventListener('click', loadSite);
    urlInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') loadSite();
    });

    window.addEventListener('load', () => {
      urlInput.focus();
      loading.style.opacity = '0';
    });
  </script>
</body>
</html>